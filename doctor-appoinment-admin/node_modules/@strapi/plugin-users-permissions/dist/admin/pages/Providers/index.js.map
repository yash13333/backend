{"version":3,"file":"index.js","sources":["../../../../admin/src/pages/Providers/index.jsx"],"sourcesContent":["import * as React from 'react';\n\nimport { useTracking, Layouts } from '@strapi/admin/strapi-admin';\nimport {\n  IconButton,\n  Table,\n  Tbody,\n  Td,\n  Th,\n  Thead,\n  Tr,\n  Typography,\n  VisuallyHidden,\n  useCollator,\n} from '@strapi/design-system';\nimport { Pencil } from '@strapi/icons';\nimport {\n  Page,\n  useAPIErrorHandler,\n  useNotification,\n  useFetchClient,\n  useRBAC,\n} from '@strapi/strapi/admin';\nimport upperFirst from 'lodash/upperFirst';\nimport { useIntl } from 'react-intl';\nimport { useMutation, useQuery, useQueryClient } from 'react-query';\n\nimport FormModal from '../../components/FormModal';\nimport { PERMISSIONS } from '../../constants';\nimport { getTrad } from '../../utils';\n\nimport forms from './utils/forms';\n\nexport const ProvidersPage = () => {\n  const { formatMessage, locale } = useIntl();\n  const queryClient = useQueryClient();\n  const { trackUsage } = useTracking();\n  const [isOpen, setIsOpen] = React.useState(false);\n  const [providerToEditName, setProviderToEditName] = React.useState(null);\n  const { toggleNotification } = useNotification();\n  const { get, put } = useFetchClient();\n  const { formatAPIError } = useAPIErrorHandler();\n  const formatter = useCollator(locale, {\n    sensitivity: 'base',\n  });\n\n  const {\n    isLoading: isLoadingPermissions,\n    allowedActions: { canUpdate },\n  } = useRBAC({ update: PERMISSIONS.updateProviders });\n\n  const { isLoading: isLoadingData, data } = useQuery(\n    ['users-permissions', 'get-providers'],\n    async () => {\n      const { data } = await get('/users-permissions/providers');\n\n      return data;\n    },\n    {\n      initialData: {},\n    }\n  );\n\n  const submitMutation = useMutation((body) => put('/users-permissions/providers', body), {\n    async onSuccess() {\n      await queryClient.invalidateQueries(['users-permissions', 'get-providers']);\n\n      toggleNotification({\n        type: 'success',\n        message: formatMessage({ id: getTrad('notification.success.submit') }),\n      });\n\n      trackUsage('didEditAuthenticationProvider');\n\n      handleToggleModal();\n    },\n    onError(error) {\n      toggleNotification({\n        type: 'danger',\n        message: formatAPIError(error),\n      });\n    },\n    refetchActive: false,\n  });\n\n  const providers = Object.entries(data)\n    .reduce((acc, [name, provider]) => {\n      const { icon, enabled, subdomain } = provider;\n\n      acc.push({\n        name,\n        icon: icon === 'envelope' ? ['fas', 'envelope'] : ['fab', icon],\n        enabled,\n        subdomain,\n      });\n\n      return acc;\n    }, [])\n    .sort((a, b) => formatter.compare(a.name, b.name));\n\n  const isLoading = isLoadingData || isLoadingPermissions;\n\n  const isProviderWithSubdomain = React.useMemo(() => {\n    if (!providerToEditName) {\n      return false;\n    }\n\n    const providerToEdit = providers.find((obj) => obj.name === providerToEditName);\n\n    return !!providerToEdit?.subdomain;\n  }, [providers, providerToEditName]);\n\n  const layoutToRender = React.useMemo(() => {\n    if (providerToEditName === 'email') {\n      return forms.email;\n    }\n\n    if (isProviderWithSubdomain) {\n      return forms.providersWithSubdomain;\n    }\n\n    return forms.providers;\n  }, [providerToEditName, isProviderWithSubdomain]);\n\n  const handleToggleModal = () => {\n    setIsOpen((prev) => !prev);\n  };\n\n  const handleClickEdit = (provider) => {\n    if (canUpdate) {\n      setProviderToEditName(provider.name);\n      handleToggleModal();\n    }\n  };\n\n  const handleSubmit = async (values) => {\n    trackUsage('willEditAuthenticationProvider');\n\n    submitMutation.mutate({ providers: { ...data, [providerToEditName]: values } });\n  };\n\n  if (isLoading) {\n    return <Page.Loading />;\n  }\n\n  return (\n    <Layouts.Root>\n      <Page.Title>\n        {formatMessage(\n          { id: 'Settings.PageTitle', defaultMessage: 'Settings - {name}' },\n          {\n            name: formatMessage({\n              id: getTrad('HeaderNav.link.providers'),\n              defaultMessage: 'Providers',\n            }),\n          }\n        )}\n      </Page.Title>\n      <Page.Main>\n        <Layouts.Header\n          title={formatMessage({\n            id: getTrad('HeaderNav.link.providers'),\n            defaultMessage: 'Providers',\n          })}\n        />\n        <Layouts.Content>\n          <Table colCount={3} rowCount={providers.length + 1}>\n            <Thead>\n              <Tr>\n                <Th>\n                  <Typography variant=\"sigma\" textColor=\"neutral600\">\n                    {formatMessage({ id: 'global.name', defaultMessage: 'Name' })}\n                  </Typography>\n                </Th>\n                <Th>\n                  <Typography variant=\"sigma\" textColor=\"neutral600\">\n                    {formatMessage({ id: getTrad('Providers.status'), defaultMessage: 'Status' })}\n                  </Typography>\n                </Th>\n                <Th>\n                  <Typography variant=\"sigma\">\n                    <VisuallyHidden>\n                      {formatMessage({\n                        id: 'global.settings',\n                        defaultMessage: 'Settings',\n                      })}\n                    </VisuallyHidden>\n                  </Typography>\n                </Th>\n              </Tr>\n            </Thead>\n            <Tbody>\n              {providers.map((provider) => (\n                <Tr\n                  key={provider.name}\n                  onClick={() => (canUpdate ? handleClickEdit(provider) : undefined)}\n                >\n                  <Td width=\"45%\">\n                    <Typography fontWeight=\"semiBold\" textColor=\"neutral800\">\n                      {provider.name}\n                    </Typography>\n                  </Td>\n                  <Td width=\"65%\">\n                    <Typography\n                      textColor={provider.enabled ? 'success600' : 'danger600'}\n                      data-testid={`enable-${provider.name}`}\n                    >\n                      {provider.enabled\n                        ? formatMessage({\n                            id: 'global.enabled',\n                            defaultMessage: 'Enabled',\n                          })\n                        : formatMessage({\n                            id: 'global.disabled',\n                            defaultMessage: 'Disabled',\n                          })}\n                    </Typography>\n                  </Td>\n                  <Td onClick={(e) => e.stopPropagation()}>\n                    {canUpdate && (\n                      <IconButton\n                        onClick={() => handleClickEdit(provider)}\n                        variant=\"ghost\"\n                        label=\"Edit\"\n                      >\n                        <Pencil />\n                      </IconButton>\n                    )}\n                  </Td>\n                </Tr>\n              ))}\n            </Tbody>\n          </Table>\n        </Layouts.Content>\n      </Page.Main>\n      <FormModal\n        initialData={data[providerToEditName]}\n        isOpen={isOpen}\n        isSubmiting={submitMutation.isLoading}\n        layout={layoutToRender}\n        headerBreadcrumbs={[\n          formatMessage({\n            id: getTrad('PopUpForm.header.edit.providers'),\n            defaultMessage: 'Edit Provider',\n          }),\n          upperFirst(providerToEditName),\n        ]}\n        onToggle={handleToggleModal}\n        onSubmit={handleSubmit}\n        providerToEditName={providerToEditName}\n      />\n    </Layouts.Root>\n  );\n};\n\nconst ProtectedProvidersPage = () => (\n  <Page.Protect permissions={PERMISSIONS.readProviders}>\n    <ProvidersPage />\n  </Page.Protect>\n);\n\nexport default ProtectedProvidersPage;\n"],"names":["ProvidersPage","formatMessage","locale","useIntl","queryClient","useQueryClient","trackUsage","useTracking","isOpen","setIsOpen","React","useState","providerToEditName","setProviderToEditName","toggleNotification","useNotification","get","put","useFetchClient","formatAPIError","useAPIErrorHandler","formatter","useCollator","sensitivity","isLoading","isLoadingPermissions","allowedActions","canUpdate","useRBAC","update","PERMISSIONS","updateProviders","isLoadingData","data","useQuery","initialData","submitMutation","useMutation","body","onSuccess","invalidateQueries","type","message","id","getTrad","handleToggleModal","onError","error","refetchActive","providers","Object","entries","reduce","acc","name","provider","icon","enabled","subdomain","push","sort","a","b","compare","isProviderWithSubdomain","useMemo","providerToEdit","find","obj","layoutToRender","forms","email","providersWithSubdomain","prev","handleClickEdit","handleSubmit","values","mutate","_jsx","Page","Loading","_jsxs","Layouts","Root","Title","defaultMessage","Main","Header","title","Content","Table","colCount","rowCount","length","Thead","Tr","Th","Typography","variant","textColor","VisuallyHidden","Tbody","map","onClick","undefined","Td","width","fontWeight","data-testid","e","stopPropagation","IconButton","label","Pencil","FormModal","isSubmiting","layout","headerBreadcrumbs","upperFirst","onToggle","onSubmit","ProtectedProvidersPage","Protect","permissions","readProviders"],"mappings":"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"}