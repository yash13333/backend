{"version":3,"file":"homepage.js","sources":["../../../../../server/src/controllers/homepage.ts"],"sourcesContent":["import type { Core } from '@strapi/types';\nimport * as yup from 'yup';\nimport { errors } from '@strapi/utils';\nimport { getService } from '../utils';\nimport type { GetRecentDocuments } from '../../../shared/contracts/homepage';\n\nconst createHomepageController = () => {\n  const homepageService = getService('homepage');\n\n  const recentDocumentParamsSchema = yup.object().shape({\n    action: yup\n      .mixed<GetRecentDocuments.Request['query']['action']>()\n      .oneOf(['update', 'publish'])\n      .required(),\n  });\n\n  return {\n    async getRecentDocuments(ctx): Promise<GetRecentDocuments.Response> {\n      let action;\n\n      try {\n        action = (await recentDocumentParamsSchema.validate(ctx.query)).action;\n      } catch (error) {\n        if (error instanceof yup.ValidationError) {\n          throw new errors.ValidationError(error.message);\n        }\n        throw error;\n      }\n\n      if (action === 'publish') {\n        return { data: await homepageService.getRecentlyPublishedDocuments() };\n      }\n\n      return { data: await homepageService.getRecentlyUpdatedDocuments() };\n    },\n  } satisfies Core.Controller;\n};\n\nexport { createHomepageController };\n"],"names":["createHomepageController","homepageService","getService","recentDocumentParamsSchema","yup","object","shape","action","mixed","oneOf","required","getRecentDocuments","ctx","validate","query","error","ValidationError","errors","message","data","getRecentlyPublishedDocuments","getRecentlyUpdatedDocuments"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;AAMA,MAAMA,wBAA2B,GAAA,IAAA;AAC/B,IAAA,MAAMC,kBAAkBC,gBAAW,CAAA,UAAA,CAAA;AAEnC,IAAA,MAAMC,0BAA6BC,GAAAA,cAAAA,CAAIC,MAAM,EAAA,CAAGC,KAAK,CAAC;AACpDC,QAAAA,MAAAA,EAAQH,cACLI,CAAAA,KAAK,EACLC,CAAAA,KAAK,CAAC;AAAC,YAAA,QAAA;AAAU,YAAA;AAAU,SAAA,CAAA,CAC3BC,QAAQ;AACb,KAAA,CAAA;IAEA,OAAO;AACL,QAAA,MAAMC,oBAAmBC,GAAG,EAAA;YAC1B,IAAIL,MAAAA;YAEJ,IAAI;gBACFA,MAAS,GAAC,CAAA,MAAMJ,0BAA2BU,CAAAA,QAAQ,CAACD,GAAIE,CAAAA,KAAK,CAAA,EAAGP,MAAM;AACxE,aAAA,CAAE,OAAOQ,KAAO,EAAA;gBACd,IAAIA,KAAAA,YAAiBX,cAAIY,CAAAA,eAAe,EAAE;AACxC,oBAAA,MAAM,IAAIC,YAAAA,CAAOD,eAAe,CAACD,MAAMG,OAAO,CAAA;AAChD;gBACA,MAAMH,KAAAA;AACR;AAEA,YAAA,IAAIR,WAAW,SAAW,EAAA;gBACxB,OAAO;oBAAEY,IAAM,EAAA,MAAMlB,gBAAgBmB,6BAA6B;AAAG,iBAAA;AACvE;YAEA,OAAO;gBAAED,IAAM,EAAA,MAAMlB,gBAAgBoB,2BAA2B;AAAG,aAAA;AACrE;AACF,KAAA;AACF;;;;"}