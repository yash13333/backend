{"version":3,"file":"data-mapper.js","sources":["../../../server/src/services/data-mapper.ts"],"sourcesContent":["import { pick, getOr } from 'lodash/fp';\nimport { contentTypes as contentTypesUtils } from '@strapi/utils';\n\nimport type { Schema, Struct } from '@strapi/types';\n\nconst dtoFields = [\n  'uid',\n  'isDisplayed',\n  'apiID',\n  'kind',\n  'category',\n  'info',\n  'options',\n  'pluginOptions',\n  'attributes',\n  'pluginOptions',\n];\n\nexport default () => ({\n  toContentManagerModel(contentType: Struct.ComponentSchema) {\n    return {\n      ...contentType,\n      apiID: contentType.modelName,\n      isDisplayed: isVisible(contentType),\n      attributes: {\n        id: {\n          type: 'integer',\n        },\n        ...formatAttributes(contentType),\n      },\n    };\n  },\n\n  toDto: pick(dtoFields),\n});\n\nconst formatAttributes = (contentType: Struct.ComponentSchema) => {\n  const { getVisibleAttributes, getTimestamps, getCreatorFields } = contentTypesUtils;\n\n  // only get attributes that can be seen in the auto generated Edit view or List view\n  return getVisibleAttributes(contentType)\n    .concat(getTimestamps(contentType))\n    .concat(getCreatorFields(contentType))\n    .reduce((acc: any, key: string) => {\n      const attribute = contentType.attributes[key];\n\n      // ignore morph until they are handled in the front\n      if (attribute.type === 'relation' && attribute.relation.toLowerCase().includes('morph')) {\n        return acc;\n      }\n\n      acc[key] = formatAttribute(key, attribute);\n      return acc;\n    }, {});\n};\n\n// FIXME: not needed\nconst formatAttribute = (key: any, attribute: Schema.Attribute.AnyAttribute) => {\n  if (attribute.type === 'relation') {\n    return toRelation(attribute);\n  }\n\n  return attribute;\n};\n\n// FIXME: not needed\nconst toRelation = (attribute: Schema.Attribute.Relation) => {\n  return {\n    ...attribute,\n    type: 'relation',\n    targetModel: 'target' in attribute ? attribute.target : undefined,\n    relationType: attribute.relation,\n  };\n};\n\nconst isVisible = (model: Struct.ComponentSchema): boolean =>\n  getOr(true, 'pluginOptions.content-manager.visible', model) === true;\n"],"names":["dtoFields","toContentManagerModel","contentType","apiID","modelName","isDisplayed","isVisible","attributes","id","type","formatAttributes","toDto","pick","getVisibleAttributes","getTimestamps","getCreatorFields","contentTypesUtils","concat","reduce","acc","key","attribute","relation","toLowerCase","includes","formatAttribute","toRelation","targetModel","target","undefined","relationType","model","getOr"],"mappings":";;;;;AAKA,MAAMA,SAAY,GAAA;AAChB,IAAA,KAAA;AACA,IAAA,aAAA;AACA,IAAA,OAAA;AACA,IAAA,MAAA;AACA,IAAA,UAAA;AACA,IAAA,MAAA;AACA,IAAA,SAAA;AACA,IAAA,eAAA;AACA,IAAA,YAAA;AACA,IAAA;AACD,CAAA;AAED,iBAAe,CAAA,KAAO;AACpBC,QAAAA,qBAAAA,CAAAA,CAAsBC,WAAmC,EAAA;YACvD,OAAO;AACL,gBAAA,GAAGA,WAAW;AACdC,gBAAAA,KAAAA,EAAOD,YAAYE,SAAS;AAC5BC,gBAAAA,WAAAA,EAAaC,SAAUJ,CAAAA,WAAAA,CAAAA;gBACvBK,UAAY,EAAA;oBACVC,EAAI,EAAA;wBACFC,IAAM,EAAA;AACR,qBAAA;AACA,oBAAA,GAAGC,iBAAiBR,WAAY;AAClC;AACF,aAAA;AACF,SAAA;AAEAS,QAAAA,KAAAA,EAAOC,OAAKZ,CAAAA,SAAAA;AACd,KAAA,CAAC;AAED,MAAMU,mBAAmB,CAACR,WAAAA,GAAAA;AACxB,IAAA,MAAM,EAAEW,oBAAoB,EAAEC,aAAa,EAAEC,gBAAgB,EAAE,GAAGC,wBAAAA;;AAGlE,IAAA,OAAOH,oBAAqBX,CAAAA,WAAAA,CAAAA,CACzBe,MAAM,CAACH,aAAcZ,CAAAA,WAAAA,CAAAA,CAAAA,CACrBe,MAAM,CAACF,gBAAiBb,CAAAA,WAAAA,CAAAA,CAAAA,CACxBgB,MAAM,CAAC,CAACC,GAAUC,EAAAA,GAAAA,GAAAA;AACjB,QAAA,MAAMC,SAAYnB,GAAAA,WAAAA,CAAYK,UAAU,CAACa,GAAI,CAAA;;QAG7C,IAAIC,SAAAA,CAAUZ,IAAI,KAAK,UAAcY,IAAAA,SAAAA,CAAUC,QAAQ,CAACC,WAAW,EAAA,CAAGC,QAAQ,CAAC,OAAU,CAAA,EAAA;YACvF,OAAOL,GAAAA;AACT;AAEAA,QAAAA,GAAG,CAACC,GAAAA,CAAI,GAAGK,eAAAA,CAAgBL,GAAKC,EAAAA,SAAAA,CAAAA;QAChC,OAAOF,GAAAA;AACT,KAAA,EAAG,EAAC,CAAA;AACR,CAAA;AAEA;AACA,MAAMM,eAAAA,GAAkB,CAACL,GAAUC,EAAAA,SAAAA,GAAAA;IACjC,IAAIA,SAAAA,CAAUZ,IAAI,KAAK,UAAY,EAAA;AACjC,QAAA,OAAOiB,UAAWL,CAAAA,SAAAA,CAAAA;AACpB;IAEA,OAAOA,SAAAA;AACT,CAAA;AAEA;AACA,MAAMK,aAAa,CAACL,SAAAA,GAAAA;IAClB,OAAO;AACL,QAAA,GAAGA,SAAS;QACZZ,IAAM,EAAA,UAAA;AACNkB,QAAAA,WAAAA,EAAa,QAAYN,IAAAA,SAAAA,GAAYA,SAAUO,CAAAA,MAAM,GAAGC,SAAAA;AACxDC,QAAAA,YAAAA,EAAcT,UAAUC;AAC1B,KAAA;AACF,CAAA;AAEA,MAAMhB,YAAY,CAACyB,KAAAA,GACjBC,QAAM,CAAA,IAAA,EAAM,yCAAyCD,KAAW,CAAA,KAAA,IAAA;;;;"}